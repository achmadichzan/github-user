import { Button, VerticalBox, HorizontalBox, Spinner } from "std-widgets.slint";
import { Theme } from "theme.slint";
import { StatCard } from "stat_card.slint";

export component DetailPage inherits Rectangle {
    in-out property <string> display-name: "";
    in-out property <string> login-name: "";
    in-out property <string> bio: "";
    in-out property <image> avatar;
    in-out property <string> repos: "0";
    in-out property <string> followers: "0";
    in-out property <string> following: "0";
    in-out property <string> profile-url: "";
    in-out property <string> created-at: "";
    in-out property <bool> is-loading: false;
    in-out property <string> error-message: "";

    callback back-requested();

    background: Theme.bg-primary;

    VerticalBox {
        width: 100%;
        height: 100%;
        alignment: start;
        padding: Theme.padding;
        spacing: Theme.spacing;

        // Back button
        HorizontalBox {
            height: 36px;
            alignment: start;

            Button {
                text: "â† Back";
                clicked => {
                    root.back-requested();
                }
            }
        }

        // Error
        if root.error-message != "" : Rectangle {
            height: 36px;
            border-radius: 8px;
            background: Theme.bg-error;

            Text {
                text: root.error-message;
                font-size: 12px;
                color: Theme.text-error;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }

        // Loading spinner
        if root.is-loading : Rectangle {
            height: 300px;
            Spinner { indeterminate: true; }
        }

        // Profile card
        if !root.is-loading && root.login-name != "" : VerticalBox {
            alignment: center;
            spacing: 12px;

            // Avatar
            Rectangle {
                height: 128px;
                width: 128px;
                border-radius: 64px;
                clip: true;
                horizontal-stretch: 0;

                Image {
                    source: root.avatar;
                    width: 128px;
                    height: 128px;
                    image-fit: cover;
                }
            }

            // Name
            Text {
                text: root.display-name;
                font-size: 24px;
                font-weight: 700;
                color: Theme.text-primary;
                horizontal-alignment: center;
            }

            // Login
            Text {
                text: "@" + root.login-name;
                font-size: 14px;
                color: Theme.text-dim;
                horizontal-alignment: center;
            }

            // Bio
            if root.bio != "" : Text {
                text: root.bio;
                font-size: 13px;
                color: Theme.text-bio;
                horizontal-alignment: center;
                wrap: word-wrap;
            }

            // Stats
            HorizontalBox {
                alignment: center;
                spacing: 12px;
                height: 80px;

                StatCard { label: "Repos";     value: root.repos; }
                StatCard { label: "Followers"; value: root.followers; }
                StatCard { label: "Following"; value: root.following; }
            }

            // Profile link
            Rectangle {
                height: 36px;
                border-radius: 8px;
                background: Theme.bg-card;

                Text {
                    text: "ðŸ”— " + root.profile-url;
                    font-size: 12px;
                    color: Theme.accent;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }

            // Joined
            Text {
                text: "Joined: " + root.created-at;
                font-size: 11px;
                color: Theme.text-subtle;
                horizontal-alignment: center;
            }
        }
    }
}
